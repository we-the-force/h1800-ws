<template>
    <div class="page" data-name="parks" id="parks">
        <!-- Top Navbar -->
        {{#test}}
            {{Nombre}}
        {{/test}}
        <div class="navbar">
            <div class="navbar-inner row no-gap">
                <div class="toolbar tabbar toolbar-bottom">
                    <div class="toolbar-inner">
                        {{#each parks}}
                        <a href="#{{slug}}" class="{{#if @last}}bright {{/if}} tab-link {{#if @first}}tab-link-active bleft{{/if}}">{{Nombre}}</a>
                        {{#each exper}}
                            <p>{{Nombre}}</p>
                        {{/each}}
                        {{/each}}
                    </div>
                </div>
            </div>
        </div>
        <div class="page-content hide-navbar-on-scroll" id="parks-page">
            <div class="tabs">
                {{#each parks}}
                    <div class="tab {{#if @first}}tab-active{{/if}}" id="{{slug}}" data-lat="{{Locacion.lat}}" data-lng="{{Locacion.lng}}" data-park="{{slug}}" data-location="{{Locacion}}">
                        <div class="cover lazy lazy-fade-in"
                            data-background="https://hacienda1800.com{{cover.path}}">
                            <div class="title">
                                <p>{{Nombre}}</p>
                            </div>
                            <div class="elements row">
                                <div class="element col">
                                    <img src="static/icons/Clock.svg" alt="">
                                    <p>Horarios</p>
                                    <p class="normal horarios">
                                        {{#horario_es}}
                                        {{value.diainicio}} - {{value.diafinal}} <br> {{value.tiempoinicio}} - {{value.tiempofin}}
                                        {{/horario_es}}
                                        </p>
                                </div>
                                <div class="element col">
                                        <img src="static/icons/Level.svg" alt="">
                                    <p>Nivel de actividades</p>
                                    <p class="normal actividad">{{nivel_actividad_es}}</p>
                                </div>
                                <div class="element col">
                                        <img src="static/icons/Clock.svg" alt="">
                                    <p>Estadía aproximada</p>
                                    <p class="normal">{{estadia_es}}</p>
                                </div>
                                <a href="#{{slug}}-map"  class="element location col">
                                        <img src="static/icons/Map.svg" alt="">
                                    <p>Ubicación</p>
                                    <p class="normal"></p>
                                </a>
                            </div>
                        </div>
                        <div class="row desc">
                            <p>
                                {{Descripcion}}
                            </p>
                        </div>
                        {{#if exper}}

                            {{#exper}}
                                 {{Nombre}}
                            {{/exper}}
                        {{else}}
                            test no
                        {{/if}}
                        {{#exper}}
                            {{Nombre}}
                        {{/exper}}
                        {{#Fotos}}
                        <div class="photo lazy lazy-fade-in" data-background="https://hacienda1800.com{{path}}">
                            <!-- <div class="txt-box left">
                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor
                                    incididunt ut labore et dolore magna aliqua.</p>
                            </div> -->
                        </div>
                        {{/Fotos}}

                        <div data-pagination='{"el": ".swiper-pagination"}' data-space-between="30" data-loop="true"
                            data-slides-per-view="auto" class="swiper-container swiper-init">
                            <!-- <div class="swiper-pagination"></div> -->
                            <div class="swiper-wrapper" id="{{slug}}-exp-slider">




                            </div>
                        </div>

                        <div id="{{slug}}-map" class="map">

                        </div>
                        <div class="footer"
                            style="background-image: url('static/img/hacienda1800-experiences-footer-lake.png')">
                            <a class="title link external" href="https://api.whatsapp.com/send?phone=521{{contact.phone}}&text=Hola%20{{contact.name}},%20quisiera%20m%C3%A1s%20informaci%C3%B3n%20sobre%20el%20{{Nombre}}" target="_blank">
                                <p>Reservar</p>
                            </a>
                            <!-- <a href="https://api.whatsapp.com/send?phone=5218662376908&text=Hola,%20quisiera%20m%C3%A1s%20informaci%C3%B3n" target="_blank" class="button button-raised button-fill link external button-round">Contacto</a> -->
                        </div>
                    </div>
                {{/each}}



            </div>
        </div>
    </div>
    <!-- Scrollable page content-->

</template>
<script>
    import $$ from 'dom7';

    export default {


        on: {

            pageInit: function(e, page) {
                console.log('init');

                var self = this;
                var app = self.$app;

                var myLatLng = self.parks[0].Locacion;

                console.log(myLatLng);

                for (let index = 0; index < self.parks.length; index++) {
                    const parque = self.parks[index];
                    for (let second = 0; second < parque.Experiencias.length; second++) {
                        const experiencia = parque.Experiencias[second];
                        var filter = '&filter[_id]=' + experiencia._id;

                        app.request.promise.json(app.methods.getCollection('Experiencias', filter))
                        .then(expe => {
                            var currentExp=expe.data.entries[0];

                            // parque.exper.push(expe.data.entries[0]);
                            // console.log(parque.exp_info);
                            console.log(currentExp);

                            var expHtml = '<div class="swiper-slide"> <div class="bg" style="background-image: url(https://hacienda1800.com'+currentExp.thumbnail.path+');"></div> <div class="txt-box"> <div class="title">'+currentExp.Nombre+'</div> <p>'+currentExp.description_short+'.</p> </div> </div>';
                            $$('#'+parque.slug+'-exp-slider').append(expHtml);


                        });
                    }

                }



                $$('.tab').on('tab:show', function (e) {
                    var currentLat = $$(this).data('lat');
                    var currentLng = $$(this).data('lng');
                    var currentPark = $$(this).data('park');
                    // var location = $$(this).data('location');
                    var location = new google.maps.LatLng(currentLat, currentLng);
                    console.log(currentLat, currentLng);

                    var map;
                    map = new google.maps.Map(document.getElementById(currentPark+'-map'), {
                        center: location,
                        zoom: 13
                    });
                    var marker = new google.maps.Marker({
                        position: location,
                        map: map
                    });
                });



                var map;
                map = new google.maps.Map(document.getElementById('canion-map'), {
                    center: myLatLng,
                    zoom: 13,
                    scrollwheel: false,
                    navigationControl: false,
                    mapTypeControl: false,
                    scaleControl: false,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                });
                var marker = new google.maps.Marker({
                    position: myLatLng,
                    map: map
                });
                //var lang = url.searchParams.get("c");

                $$('.dynamic-popup').on('click', function() {
                    dynamicPopup.open();
                });
                $$('.element.location').on('click', function(e) {
                    e.preventDefault();
                    var move = $$(this).attr('href');
                    move = move.toString();
                    move = move.replace('#', '');
                    move = document.getElementById(move);

                    move= move.offsetTop;
                    console.log(move);

                    document.getElementById('parks-page').scrollTop = move;


                });
            }
        }

    }
</script>