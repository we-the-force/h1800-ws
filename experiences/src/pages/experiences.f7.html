<template>
    <div class="page" data-name="experiences" id="experiences">


        <div class="page-content">
            <div class="cover">
                <div class="title">
                    <p>Experiencias</p>
                </div>
            </div>
            <div class="experiences">

                    <div class="row no-gap">
                        {{#each experiences}}

                        <div class="col-100 small-50 large-25">
                            <a class="experience" href="#" data-id="{{_id}}" data-popup=".popup-push">
                                {{#each Fotos}}
                                {{if @first}}
                                <div data-background="https://hacienda1800.com{{path}}" class="bg lazy lazy-fade-in" ></div>
                                {{/if}}

                                {{/each}}
                                <div class="title">
                                    <p>{{Nombre}}</p>
                                </div>
                            </a>
                        </div>
                        <!-- each card closes -->
                        {{/each}}
                    </div>

            </div>
            <div class="footer"
                style="background-image: url('static/img/hacienda1800-experiences-footer-lake.png')">
                <a class="title link external" href="https://api.whatsapp.com/send?phone=5218112542360&text=Hola%Touroperadora,%20quisiera%20m%C3%A1s%20informaci%C3%B3n%20sobre%20las%20experiencias." target="_blank">
                    <p>Reservar</p>
                </a>
                <!-- <a href="https://api.whatsapp.com/send?phone=5218662376908&text=Hola,%20quisiera%20m%C3%A1s%20informaci%C3%B3n" target="_blank" class="button button-raised button-fill link external button-round">Contacto</a> -->
            </div>

        </div>

</template>

<script>
    import $$ from 'dom7';
    export default {
        on: {
            pageInit: function(e, page) {

                var self = this;
                var app = self.$app;
                var map;
                $$('.dynamic-popup').on('click', function () {
                  dynamicPopup.open();
                });
                // map = new google.maps.Map(document.getElementById('map'), {
                //     center: {
                //         lat: -34.397,
                //         lng: 150.644
                //     },
                //     zoom: 8
                // });
                // click para abrir popup de experiencia
                $$('.experience').on('click', function (e) {
                    e.preventDefault();
                    // traemos id de la experiencia del botón que le dimos click
                    var exp_id = $$(this).data('id');
                    // guardamos el id para filtrar en el api
                    var filter = '&filter[_id]=' + exp_id;
                    // hacemos petición al api con promise de la experiencia que le dimos click por id
                    app.request.promise.json(app.methods.getCollection('Experiencias', filter))
                    .then(expe => {
                        // cachamos el objeto experiencia
                        var currentExp=expe.data.entries[0];
                        // creamos dinámicamente el popup
                        var dynamicPopup = app.popup.create({
                          content: '<div class="experiences-pop popup  popup-push"> <a class="link popup-close" href="#"><i class="material-icons md-only">close</i></a> <div class="cover" style="background-image: url(https://hacienda1800.com'+currentExp.Fotos[0].path+');"> <div class="title"> <p>'+currentExp.Nombre+'</p> </div> </div> <div class="block"> <h3>Qué incluye</h3> <p>'+currentExp.Descripcion+'</p> </div> <div id="map-'+currentExp.Nombre+'" class="exp-map"></div> </div>',
                          on: {
                            open: function (popup) {



                            },
                            opened: function (popup) {
                            //   console.log(popup);
                                var location = currentExp.Locacion;
                                console.log(location);

                                var map;
                                map = new google.maps.Map(document.getElementById('map-'+currentExp.Nombre), {
                                    center: location,
                                    zoom: 13,
                                    scrollwheel: false,
                                    navigationControl: false,
                                    mapTypeControl: false,
                                    scaleControl: false,
                                    mapTypeId: google.maps.MapTypeId.ROADMAP
                                });
                                var marker = new google.maps.Marker({
                                    position: location,
                                    map: map
                                });
                            },
                          }
                        });

                        return dynamicPopup;

                    }).then(dynamicPopup => {
                        dynamicPopup.open();
                    });
                //
                });



            }
        }

    }
</script>